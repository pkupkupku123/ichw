# 高速缓冲存储器（Cache）的结构与工作原理
## 基本概念
Cache是一种速度远快于内存（接近于CPU寄存器），容量远小于内存又大于寄存器的存储器。  
Cache用于解决CPU与I/O设备及主存速度不匹配的问题。  
## 结构
Cache由Cache存储体、地址映象变换机构、Cache替换机构几大模块组成。  
**Cache存储体**  
Cache存储体中缓存了部分主存中的数据。  
**地址映像变换机构**  
用于将CPU送来的主存地址转换为Cache地址，进而判断命中与否。  
**Cache替换机构**  
当Cache存储体中的空间占满又需更新时，替换机构按一定的**替换算法**将其中部分数据替换为所需数据。  
## 工作原理
**0**.  *程序访问的局部性原理*（Cache工作的理论基础）  
  由于指令和数据在主存内都是连续存放的，并且CPU访问数据往往有重复性，因此CPU在执行程序时，访存具有**相对的局部性**。  
  程序访问的局部性使得用一个**容量小但高速的存储器**来**部分替代**主存成为可能的计算机提速方案。  
**1**.  Cache根据一定的*算法*，将部分主存中的数据存进存储体中（通常是最近常用的数据）。  
**2**.  CPU需要访问主存时，首先访问Cache：  
  如果所需数据已在Cache中，则直接从Cache中读取，称为**命中**。  
  如果不在，则称为**未命中**，此时需要Cache从主存中将所需的数据块覆盖到存储器中，再由CPU从Cache中读取。   
**3**.  关于命中率  
  命中率是衡量Cache效率的重要指标，命中率与Cache的容量成正相关，但由于Cache的造价高昂，现在的Cache多是均衡了效率与成本的。  
  通常命中率能有80%就比较不错，能达到90%就很优秀了。  
## 一些其他东西
**1**.  L1和L2  
  为了方便使用，Cache分为L1和L2两种。  
  L1 Cache: 第一级, CPU 内（可以提高外部总线利用率）  
  L2 Cache: 在 L1 Cache 和内存间（L2 Cache主要解决未命中时访问主存大量占用外部总线的问题）  
**2**.  算法  
从上述阐述中，可以看出要提高命中率，Cache从主存中复制数据块的算法很重要。即要提高Cache的工作效率，算法很重要。
